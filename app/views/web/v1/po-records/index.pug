extends ./../../../layouts/default
include ./../../../shared/mixins

block content
  .container-fluid
    .row
      .col
        a.btn.btn-link.my-2(href="/portal")
          i.fa.fa-arrow-left
          | &nbsp;Back to Home Page

    .row
      include ./../../../shared/pagination

    .row.my-3
      .col
        h2 PO Records

    .row
      .col.text-right
        input#file-upload(type="file", accept=".csv")

    .row.mt-3
      .col
        table.table.table-responsive
          tr
            th id
            th Uploaded By
            th Status
            th PO Number
            th Material Number
            th Material Description
            th Target Quantity (g)
            th Input Quantity (g)
            th Produced Quantity (g)
            th Target Completion Date
            th Created At
            th Start Time
            th End Time

          for p in poRecords
            tr
              td
                a(href=`/po-records/${p.id}`)= p.id
              td= p.user ? p.user.name : ''
              td= p.status
              td= p.po_number
              td= p.material_number
              td= p.material_description
              td
                +convert_to_thousand(p.target_quantity)
              td
                +convert_to_thousand(p.input_quantity)
              td
                +convert_to_thousand(p.produced_quantity)
              td
                +format_date(p.target_completion_date)
              td
                +format_datetime(p.created_at)
              td
                +format_datetime(p.start_time)
              td
                +format_datetime(p.end_time)

    .row
      include ./../../../shared/pagination

  script.
    $('#file-upload').on('change', function() {
      // The Javascript
      var fileInput = document.getElementById('file-upload');
      var file = fileInput.files[0];
      var formData = new FormData();
      formData.append('file', file);

      var xhr = new XMLHttpRequest();
      // Add any event handlers here...
      xhr.open('POST', '/po-records/shortfall', true);
      xhr.send(formData)

      xhr.onreadystatechange = function() {
        if (xhr.readyState == XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            location.reload();
          }
        }
      }
    })
